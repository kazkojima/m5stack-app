/* A simple LUT sincosf.  */

#define NW 1024
#define PI 3.141592653589793f

/* The table is generated with a python3 snipet:
import math

nw = 1024
delta = math.pi/2/nw
stable = [math.sin(i*delta) for i in range(0,nw)]
print("static float stable[NW] = {")
for i in range(0,nw):
    print(" ", '{:#.8f}'.format(stable[i]), end=',')
    if ((i+1)%4 == 0):
        print()

print("};")
*/

static const float stable[NW] = {
  0.00000000,  0.00153398,  0.00306796,  0.00460193,
  0.00613588,  0.00766983,  0.00920375,  0.01073766,
  0.01227154,  0.01380539,  0.01533921,  0.01687299,
  0.01840673,  0.01994043,  0.02147408,  0.02300768,
  0.02454123,  0.02607472,  0.02760815,  0.02914151,
  0.03067480,  0.03220803,  0.03374117,  0.03527424,
  0.03680722,  0.03834012,  0.03987293,  0.04140564,
  0.04293826,  0.04447077,  0.04600318,  0.04753548,
  0.04906767,  0.05059975,  0.05213170,  0.05366354,
  0.05519524,  0.05672682,  0.05825826,  0.05978957,
  0.06132074,  0.06285176,  0.06438263,  0.06591335,
  0.06744392,  0.06897433,  0.07050457,  0.07203465,
  0.07356456,  0.07509430,  0.07662386,  0.07815324,
  0.07968244,  0.08121145,  0.08274026,  0.08426889,
  0.08579731,  0.08732554,  0.08885355,  0.09038136,
  0.09190896,  0.09343634,  0.09496350,  0.09649043,
  0.09801714,  0.09954362,  0.10106986,  0.10259587,
  0.10412163,  0.10564715,  0.10717242,  0.10869744,
  0.11022221,  0.11174671,  0.11327095,  0.11479493,
  0.11631863,  0.11784206,  0.11936521,  0.12088809,
  0.12241068,  0.12393298,  0.12545498,  0.12697670,
  0.12849811,  0.13001922,  0.13154003,  0.13306053,
  0.13458071,  0.13610058,  0.13762012,  0.13913934,
  0.14065824,  0.14217680,  0.14369503,  0.14521292,
  0.14673047,  0.14824768,  0.14976453,  0.15128104,
  0.15279719,  0.15431297,  0.15582840,  0.15734346,
  0.15885814,  0.16037246,  0.16188639,  0.16339995,
  0.16491312,  0.16642590,  0.16793829,  0.16945029,
  0.17096189,  0.17247308,  0.17398387,  0.17549425,
  0.17700422,  0.17851377,  0.18002290,  0.18153161,
  0.18303989,  0.18454774,  0.18605515,  0.18756213,
  0.18906866,  0.19057475,  0.19208040,  0.19358559,
  0.19509032,  0.19659460,  0.19809841,  0.19960176,
  0.20110463,  0.20260704,  0.20410897,  0.20561041,
  0.20711138,  0.20861185,  0.21011184,  0.21161133,
  0.21311032,  0.21460881,  0.21610680,  0.21760427,
  0.21910124,  0.22059769,  0.22209362,  0.22358903,
  0.22508391,  0.22657826,  0.22807208,  0.22956537,
  0.23105811,  0.23255031,  0.23404196,  0.23553306,
  0.23702361,  0.23851359,  0.24000302,  0.24149189,
  0.24298018,  0.24446790,  0.24595505,  0.24744162,
  0.24892761,  0.25041301,  0.25189782,  0.25338204,
  0.25486566,  0.25634868,  0.25783110,  0.25931292,
  0.26079412,  0.26227471,  0.26375468,  0.26523403,
  0.26671276,  0.26819086,  0.26966833,  0.27114516,
  0.27262136,  0.27409691,  0.27557182,  0.27704608,
  0.27851969,  0.27999264,  0.28146494,  0.28293657,
  0.28440754,  0.28587783,  0.28734746,  0.28881641,
  0.29028468,  0.29175226,  0.29321916,  0.29468537,
  0.29615089,  0.29761571,  0.29907983,  0.30054324,
  0.30200595,  0.30346795,  0.30492923,  0.30638980,
  0.30784964,  0.30930876,  0.31076715,  0.31222481,
  0.31368174,  0.31513793,  0.31659338,  0.31804808,
  0.31950203,  0.32095523,  0.32240768,  0.32385937,
  0.32531029,  0.32676045,  0.32820984,  0.32965846,
  0.33110631,  0.33255337,  0.33399965,  0.33544515,
  0.33688985,  0.33833377,  0.33977688,  0.34121920,
  0.34266072,  0.34410143,  0.34554132,  0.34698041,
  0.34841868,  0.34985613,  0.35129276,  0.35272856,
  0.35416353,  0.35559766,  0.35703096,  0.35846342,
  0.35989504,  0.36132581,  0.36275572,  0.36418479,
  0.36561300,  0.36704035,  0.36846683,  0.36989245,
  0.37131719,  0.37274107,  0.37416406,  0.37558618,
  0.37700741,  0.37842775,  0.37984721,  0.38126577,
  0.38268343,  0.38410020,  0.38551605,  0.38693101,
  0.38834505,  0.38975817,  0.39117038,  0.39258167,
  0.39399204,  0.39540148,  0.39680999,  0.39821756,
  0.39962420,  0.40102990,  0.40243465,  0.40383846,
  0.40524131,  0.40664322,  0.40804416,  0.40944415,
  0.41084317,  0.41224123,  0.41363831,  0.41503442,
  0.41642956,  0.41782372,  0.41921689,  0.42060907,
  0.42200027,  0.42339047,  0.42477968,  0.42616789,
  0.42755509,  0.42894129,  0.43032648,  0.43171066,
  0.43309382,  0.43447596,  0.43585708,  0.43723717,
  0.43861624,  0.43999427,  0.44137127,  0.44274723,
  0.44412214,  0.44549602,  0.44686884,  0.44824061,
  0.44961133,  0.45098099,  0.45234959,  0.45371712,
  0.45508359,  0.45644898,  0.45781330,  0.45917655,
  0.46053871,  0.46189979,  0.46325978,  0.46461869,
  0.46597650,  0.46733321,  0.46868882,  0.47004333,
  0.47139674,  0.47274903,  0.47410021,  0.47545028,
  0.47679923,  0.47814706,  0.47949376,  0.48083933,
  0.48218377,  0.48352708,  0.48486925,  0.48621028,
  0.48755016,  0.48888890,  0.49022648,  0.49156292,
  0.49289819,  0.49423231,  0.49556526,  0.49689705,
  0.49822767,  0.49955711,  0.50088538,  0.50221247,
  0.50353838,  0.50486311,  0.50618665,  0.50750899,
  0.50883014,  0.51015010,  0.51146885,  0.51278640,
  0.51410274,  0.51541788,  0.51673180,  0.51804450,
  0.51935599,  0.52066625,  0.52197529,  0.52328310,
  0.52458968,  0.52589503,  0.52719913,  0.52850200,
  0.52980362,  0.53110400,  0.53240313,  0.53370100,
  0.53499762,  0.53629298,  0.53758708,  0.53887991,
  0.54017147,  0.54146177,  0.54275078,  0.54403853,
  0.54532499,  0.54661017,  0.54789406,  0.54917666,
  0.55045797,  0.55173799,  0.55301671,  0.55429412,
  0.55557023,  0.55684504,  0.55811853,  0.55939071,
  0.56066158,  0.56193112,  0.56319934,  0.56446624,
  0.56573181,  0.56699605,  0.56825895,  0.56952052,
  0.57078075,  0.57203963,  0.57329717,  0.57455336,
  0.57580819,  0.57706167,  0.57831380,  0.57956456,
  0.58081396,  0.58206199,  0.58330865,  0.58455394,
  0.58579786,  0.58704039,  0.58828155,  0.58952132,
  0.59075970,  0.59199669,  0.59323230,  0.59446650,
  0.59569930,  0.59693071,  0.59816071,  0.59938930,
  0.60061648,  0.60184225,  0.60306660,  0.60428953,
  0.60551104,  0.60673113,  0.60794978,  0.60916701,
  0.61038281,  0.61159716,  0.61281008,  0.61402156,
  0.61523159,  0.61644017,  0.61764731,  0.61885299,
  0.62005721,  0.62125998,  0.62246128,  0.62366112,
  0.62485949,  0.62605639,  0.62725182,  0.62844577,
  0.62963824,  0.63082923,  0.63201874,  0.63320676,
  0.63439328,  0.63557832,  0.63676186,  0.63794390,
  0.63912444,  0.64030348,  0.64148101,  0.64265703,
  0.64383154,  0.64500454,  0.64617601,  0.64734597,
  0.64851440,  0.64968131,  0.65084668,  0.65201053,
  0.65317284,  0.65433362,  0.65549285,  0.65665055,
  0.65780669,  0.65896129,  0.66011434,  0.66126584,
  0.66241578,  0.66356416,  0.66471098,  0.66585623,
  0.66699992,  0.66814204,  0.66928259,  0.67042156,
  0.67155895,  0.67269477,  0.67382900,  0.67496165,
  0.67609270,  0.67722217,  0.67835004,  0.67947632,
  0.68060100,  0.68172407,  0.68284555,  0.68396541,
  0.68508367,  0.68620031,  0.68731534,  0.68842875,
  0.68954054,  0.69065071,  0.69175926,  0.69286617,
  0.69397146,  0.69507511,  0.69617713,  0.69727751,
  0.69837625,  0.69947334,  0.70056879,  0.70166259,
  0.70275474,  0.70384524,  0.70493408,  0.70602126,
  0.70710678,  0.70819064,  0.70927283,  0.71035335,
  0.71143220,  0.71250937,  0.71358487,  0.71465869,
  0.71573083,  0.71680128,  0.71787005,  0.71893712,
  0.72000251,  0.72106620,  0.72212819,  0.72318849,
  0.72424708,  0.72530397,  0.72635916,  0.72741263,
  0.72846439,  0.72951444,  0.73056277,  0.73160938,
  0.73265427,  0.73369744,  0.73473888,  0.73577859,
  0.73681657,  0.73785281,  0.73888732,  0.73992010,
  0.74095113,  0.74198041,  0.74300795,  0.74403374,
  0.74505779,  0.74608007,  0.74710061,  0.74811938,
  0.74913639,  0.75015165,  0.75116513,  0.75217685,
  0.75318680,  0.75419498,  0.75520138,  0.75620600,
  0.75720885,  0.75820991,  0.75920919,  0.76020668,
  0.76120239,  0.76219630,  0.76318842,  0.76417874,
  0.76516727,  0.76615399,  0.76713891,  0.76812203,
  0.76910334,  0.77008284,  0.77106052,  0.77203640,
  0.77301045,  0.77398269,  0.77495311,  0.77592170,
  0.77688847,  0.77785340,  0.77881651,  0.77977779,
  0.78073723,  0.78169483,  0.78265060,  0.78360452,
  0.78455660,  0.78550683,  0.78645521,  0.78740175,
  0.78834643,  0.78928925,  0.79023022,  0.79116933,
  0.79210658,  0.79304196,  0.79397548,  0.79490713,
  0.79583690,  0.79676481,  0.79769084,  0.79861499,
  0.79953727,  0.80045766,  0.80137617,  0.80229280,
  0.80320753,  0.80412038,  0.80503133,  0.80594039,
  0.80684755,  0.80775282,  0.80865618,  0.80955764,
  0.81045720,  0.81135485,  0.81225059,  0.81314441,
  0.81403633,  0.81492633,  0.81581441,  0.81670057,
  0.81758481,  0.81846713,  0.81934752,  0.82022598,
  0.82110251,  0.82197712,  0.82284978,  0.82372051,
  0.82458930,  0.82545615,  0.82632106,  0.82718403,
  0.82804505,  0.82890411,  0.82976123,  0.83061640,
  0.83146961,  0.83232087,  0.83317016,  0.83401750,
  0.83486287,  0.83570628,  0.83654773,  0.83738720,
  0.83822471,  0.83906024,  0.83989379,  0.84072537,
  0.84155498,  0.84238260,  0.84320824,  0.84403190,
  0.84485357,  0.84567325,  0.84649094,  0.84730664,
  0.84812034,  0.84893206,  0.84974177,  0.85054948,
  0.85135519,  0.85215890,  0.85296060,  0.85376030,
  0.85455799,  0.85535366,  0.85614733,  0.85693898,
  0.85772861,  0.85851622,  0.85930182,  0.86008539,
  0.86086694,  0.86164646,  0.86242396,  0.86319942,
  0.86397286,  0.86474426,  0.86551362,  0.86628095,
  0.86704625,  0.86780950,  0.86857071,  0.86932987,
  0.87008699,  0.87084206,  0.87159509,  0.87234606,
  0.87309498,  0.87384184,  0.87458665,  0.87532940,
  0.87607009,  0.87680872,  0.87754529,  0.87827979,
  0.87901223,  0.87974259,  0.88047089,  0.88119711,
  0.88192126,  0.88264334,  0.88336334,  0.88408126,
  0.88479710,  0.88551086,  0.88622253,  0.88693212,
  0.88763962,  0.88834503,  0.88904836,  0.88974959,
  0.89044872,  0.89114576,  0.89184071,  0.89253356,
  0.89322430,  0.89391295,  0.89459949,  0.89528392,
  0.89596625,  0.89664647,  0.89732458,  0.89800058,
  0.89867447,  0.89934624,  0.90001589,  0.90068343,
  0.90134885,  0.90201214,  0.90267332,  0.90333237,
  0.90398929,  0.90464409,  0.90529676,  0.90594730,
  0.90659570,  0.90724198,  0.90788612,  0.90852812,
  0.90916798,  0.90980571,  0.91044129,  0.91107473,
  0.91170603,  0.91233518,  0.91296219,  0.91358705,
  0.91420976,  0.91483031,  0.91544872,  0.91606497,
  0.91667906,  0.91729100,  0.91790078,  0.91850839,
  0.91911385,  0.91971715,  0.92031828,  0.92091724,
  0.92151404,  0.92210867,  0.92270113,  0.92329142,
  0.92387953,  0.92446547,  0.92504924,  0.92563083,
  0.92621024,  0.92678747,  0.92736253,  0.92793539,
  0.92850608,  0.92907458,  0.92964090,  0.93020502,
  0.93076696,  0.93132671,  0.93188427,  0.93243963,
  0.93299280,  0.93354377,  0.93409255,  0.93463913,
  0.93518351,  0.93572569,  0.93626567,  0.93680344,
  0.93733901,  0.93787238,  0.93840353,  0.93893248,
  0.93945922,  0.93998375,  0.94050607,  0.94102618,
  0.94154407,  0.94205974,  0.94257320,  0.94308444,
  0.94359346,  0.94410026,  0.94460484,  0.94510719,
  0.94560733,  0.94610523,  0.94660091,  0.94709437,
  0.94758559,  0.94807459,  0.94856135,  0.94904588,
  0.94952818,  0.95000825,  0.95048607,  0.95096167,
  0.95143502,  0.95190614,  0.95237501,  0.95284165,
  0.95330604,  0.95376819,  0.95422810,  0.95468575,
  0.95514117,  0.95559433,  0.95604525,  0.95649392,
  0.95694034,  0.95738450,  0.95782641,  0.95826607,
  0.95870347,  0.95913862,  0.95957151,  0.96000215,
  0.96043052,  0.96085663,  0.96128049,  0.96170208,
  0.96212140,  0.96253847,  0.96295327,  0.96336580,
  0.96377607,  0.96418406,  0.96458979,  0.96499325,
  0.96539444,  0.96579336,  0.96619000,  0.96658437,
  0.96697647,  0.96736629,  0.96775384,  0.96813910,
  0.96852209,  0.96890280,  0.96928124,  0.96965739,
  0.97003125,  0.97040284,  0.97077214,  0.97113916,
  0.97150389,  0.97186634,  0.97222650,  0.97258437,
  0.97293995,  0.97329325,  0.97364425,  0.97399296,
  0.97433938,  0.97468351,  0.97502535,  0.97536489,
  0.97570213,  0.97603708,  0.97636973,  0.97670009,
  0.97702814,  0.97735390,  0.97767736,  0.97799851,
  0.97831737,  0.97863392,  0.97894818,  0.97926012,
  0.97956977,  0.97987710,  0.98018214,  0.98048486,
  0.98078528,  0.98108339,  0.98137919,  0.98167269,
  0.98196387,  0.98225274,  0.98253930,  0.98282355,
  0.98310549,  0.98338511,  0.98366242,  0.98393741,
  0.98421009,  0.98448046,  0.98474850,  0.98501423,
  0.98527764,  0.98553874,  0.98579751,  0.98605396,
  0.98630810,  0.98655991,  0.98680940,  0.98705657,
  0.98730142,  0.98754394,  0.98778414,  0.98802202,
  0.98825757,  0.98849079,  0.98872169,  0.98895026,
  0.98917651,  0.98940043,  0.98962202,  0.98984128,
  0.99005821,  0.99027281,  0.99048508,  0.99069503,
  0.99090264,  0.99110791,  0.99131086,  0.99151147,
  0.99170975,  0.99190570,  0.99209931,  0.99229059,
  0.99247953,  0.99266614,  0.99285041,  0.99303235,
  0.99321195,  0.99338921,  0.99356414,  0.99373672,
  0.99390697,  0.99407488,  0.99424045,  0.99440368,
  0.99456457,  0.99472312,  0.99487933,  0.99503320,
  0.99518473,  0.99533391,  0.99548076,  0.99562526,
  0.99576741,  0.99590723,  0.99604470,  0.99617983,
  0.99631261,  0.99644305,  0.99657115,  0.99669690,
  0.99682030,  0.99694136,  0.99706007,  0.99717644,
  0.99729046,  0.99740213,  0.99751146,  0.99761844,
  0.99772307,  0.99782535,  0.99792529,  0.99802287,
  0.99811811,  0.99821100,  0.99830154,  0.99838974,
  0.99847558,  0.99855907,  0.99864022,  0.99871901,
  0.99879546,  0.99886955,  0.99894129,  0.99901069,
  0.99907773,  0.99914242,  0.99920476,  0.99926475,
  0.99932238,  0.99937767,  0.99943060,  0.99948119,
  0.99952942,  0.99957530,  0.99961882,  0.99966000,
  0.99969882,  0.99973529,  0.99976941,  0.99980117,
  0.99983058,  0.99985764,  0.99988235,  0.99990470,
  0.99992470,  0.99994235,  0.99995764,  0.99997059,
  0.99998118,  0.99998941,  0.99999529,  0.99999882,
};

static float
kernel_lut_sinf (float x)
{
  float co;
  int i = (int) ((x * 2 * NW)/PI);
  float y = x - i * PI /(2 * NW);
  if (i == NW)
    return 1.0;
  if (i == 0)
    co = 1.0;
  else
    co = stable[NW - i];
  return stable[i] * (1 - y*y/2) + co * (y - y*y*y/6);
}

float
sinf (float x)
{
  float r;
  int i;
  int sig = 1;
  if (x < 0)
    {
      sig = -1;
      x = -x;
    }
  i = (int) (x / (2 * PI));
  r = x - i * 2 * PI;
  if (r > PI)
    {
      sig = -sig;
      r -= PI;
    }
  if (r > PI/2)
    r = PI - r;
  return (sig > 0) ? kernel_lut_sinf(r) : -kernel_lut_sinf(r);
}

float
cosf (float x)
{
  return sinf (x + PI/2);
}

void
sincosf (float x, float *s, float *c)
{
  if (s)
    *s = sinf (x);
  if (c)
    *c = cosf (x);
}

#if 0
#include <math.h>

int main ()
{
  int i;
  for (i = 0; i < 4096; i++)
    {
      float s, c;
      float x = i*PI/4096/2;
      lut_sincosf (x, &s, &c);
      printf ("%f %f\n", (double)s - sin(x), (double)c - cos(x));
    }
  return 0;
}
#endif
